<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Emergency Hotline - Updated</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha512-DxV+EoADOkOygM4IR9yXP8Sb2qwgidEmeqAEmDKIOfPRQZOWbXCzLC6vjbZyy0vPisbH2SyW27+ddLVCN+OMzQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />

  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" />

  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .soft-card {
      background-color: #FFFFFF;
      border-radius: 1rem;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    }
  </style>
</head>
<nav class="navbar bg-white bg-opacity-70 shadow sticky top-0 z-50">
  <div class="container mx-auto px-4 flex flex-col sm:flex-row items-center justify-between py-2 gap-3 sm:gap-0">
    <div class="flex items-center gap-3">
      <div class="w-16 h-16 sm:w-20 sm:h-20 rounded-full ring ring-white ring-offset-2 ring-offset-emerald-400 p-1">
        <img src="./assets/logo-dark.png" alt="Logo" class="w-full h-full object-contain rounded-full" />
      </div>
      <span class="text-xl sm:text-2xl font-bold leading-tight text-green-800">
        Emergency <br class="hidden sm:block" /> Service
      </span>
    </div>

    <div class="flex items-center gap-2 sm:gap-3">
      <div class="flex items-center bg-green-50 rounded-full px-3 py-1 gap-1">
        <span class="text-sm font-semibold text-black" id="heartCount">0</span>
        <i class="fa-solid fa-heart text-red-500"></i> </div>
      <button id="copyPill" class="btn btn-success btn-sm rounded-full text-white normal-case px-4">
        <span id="copyCount">0</span> Copy
      </button>
    </div>
  </div>
</nav>

<header class="w-full">
  <div class="hero min-h-[220px] bg-gradient-to-br from-green-900 via-green-900 to-emerald-900 text-white">
    <div class="hero-content text-center w-full">
      <div class="flex flex-col items-center w-full">
        <div class="mb-4">
          <div class="w-20 h-20 md:w-24 md:h-24 rounded-full ring ring-white ring-offset-2 ring-offset-emerald-400 bg-white p-1 flex items-center justify-center">
            <img src="./assets/logo.png" alt="Gov Logo" class="w-full h-full object-contain rounded-full" />
          </div>
        </div>
        <h1 class="text-2xl md:text-3xl font-extrabold">Emergency Service Directory</h1>
        <p class="text-sm md:text-base text-white/90 mt-2 px-4 max-w-2xl">
          Government Emergency Services at Your Fingertip - A Project by <strong>Government of the People's Republic of Bangladesh</strong>
        </p>
      </div>
    </div>
  </div>
</header>

<section class="bg-white bg-opacity-70 pt-0">
  <main class="container mx-auto px-3 md:px-4 lg:px-6">
    <div class="grid grid-cols-12 gap-4 md:gap-6">
      
      <section class="col-span-12 lg:col-span-9 mt-6 md:mt-10">
        <div id="cardGrid" class="grid sm:grid-cols-2 xl:grid-cols-3 gap-3 md:gap-5"></div>
      </section>

      <aside class="col-span-12 lg:col-span-3 mt-6 md:mt-10">
        <div class="soft-card bg-base-100 rounded-2xl p-4 md:p-5">
          <div class="flex items-center justify-between mb-4">
            <div class="flex items-center gap-2">
              <span ><i class="fa-regular fa-clock"></i></span>
              <h2 class="font-semibold text-lg text-black">Call History</h2>
            </div>
            <button id="clearHistory" class="btn btn !bg-[#00A63E] text-white">Clear</button>
          </div>
          <ul id="historyList" class="space-y-3 max-h-[520px] overflow-y-auto pr-2"></ul>
        </div>
      </aside>

    </div>
  </main>
</section>

<template id="cardTemplate">
  <div class="soft-card bg-base-100 rounded-2xl p-5 flex flex-col gap-4 relative">
    
    <div class="flex justify-between items-start">
      <div class="avatar">
        <div class="w-8 h-8 rounded-xl bg-emerald-100 flex items-center justify-center text-2xl">
            <img data-role="icon" src="" alt="Service Icon" class="w-6 h-6 object-contain"/>        
        </div>
      </div>
      <button class="btn btn-ghost btn-circle btn-sm" data-role="heartBtn" aria-label="Add to favourites">
        <i data-role="heartIcon" class="fa-solid fa-heart text-gray-400 hover:text-red-500"></i>
      </button>
    </div>

    <div>
      <h2 class="font-bold text-xl leading-snug text-black" data-role="title">Service Name</h2>
      <p class="text-sm text-base-content " data-role="subtitle">Department</p>
    </div>

    <div>
      <div class="text-2xl font-extrabold tracking-wide text-black" data-role="number">999</div>
    </div>

    <div class=" items-center justify-between mt-auto">
      <div class="badge badge-outline text-sm    block" data-role="badge">Category</div> <br>
      <div class="flex  justify-between gap-2">
        <button class="btn btn btn-outline" data-role="copyBtn">
          <i class="fa-solid fa-copy mr-1"></i> Copy
        </button>
        <button class="btn btn btn-success text-white" data-role="callBtn">
          <i class="fa-solid fa-phone-volume mr-1"></i> Call
        </button>
      </div>
    </div>

  </div>
</template>

<script>
(function () {
  // Local Storage Key
  const STORAGE_KEY = 'emergencyHotlineState'; // Local Storage এ ডেটা সেভ করার জন্য একটি কী

  function loadState() {
    try {
      const storedState = localStorage.getItem(STORAGE_KEY);
      if (storedState) {
        return JSON.parse(storedState);
      }
    } catch (e) {
      console.error("Error loading state from localStorage", e);
    }
    // যদি কোনো ডেটা না থাকে বা লোড করতে ব্যর্থ হয়, তাহলে ডিফল্ট স্টেট রিটার্ন করবে
    return {
      hearts: 0, // টোটাল ফেভারিট কাউন্টার
      copies: 0,
      services: getServices(),
      history: [],
      favoriteIds: {} // কোন সার্ভিসগুলো ফেভারিট তার ID ট্র্যাক করার জন্য
    };
  }

  function saveState() {
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify({
        hearts: state.hearts,
        copies: state.copies,
        history: state.history,
        favoriteIds: state.favoriteIds
      }));
    } catch (e) {
      console.error("Error saving state to localStorage", e);
    }
  }

  // UPDATED: state এ 'coins' এবং 'coinCount' বাদ দেওয়া হয়েছে
  let state = loadState();

  const el = {
    heartCount: document.getElementById('heartCount'),
    coinCount: document.getElementById('coinCount'), // এই এলিমেন্টটি আর ব্যবহার হবে না, তবে কোডে রেখে দেওয়া হয়েছে
    copyCount: document.getElementById('copyCount'),
    cardGrid: document.getElementById('cardGrid'),
    historyList: document.getElementById('historyList'),
    clearHistory: document.getElementById('clearHistory'),
    cardTemplate: document.getElementById('cardTemplate')
  };

  function init() {
    // UPDATED: state.services এর সাথে favorites যোগ করা
    state.services = getServices().map(svc => ({
      ...svc,
      isFavorite: !!state.favoriteIds[svc.id] // local storage থেকে লোড করা favoriteId অনুযায়ী স্ট্যাটাস সেট করা
    }));

    renderCards();
    bindGlobalUI();
    updateCounters();
    renderHistory(); // Local Storage থেকে লোড করা ইতিহাস দেখানোর জন্য
  }

  function renderCards() {
    el.cardGrid.innerHTML = '';
    state.services.forEach(function (svc) {
      const card = el.cardTemplate.content.cloneNode(true);

      card.querySelector('[data-role="icon"]').src = svc.icon;
      card.querySelector('[data-role="title"]').textContent = svc.title;
      card.querySelector('[data-role="subtitle"]').textContent = svc.subtitle;
      card.querySelector('[data-role="number"]').textContent = svc.number;
      card.querySelector('[data-role="badge"]').textContent = svc.category;

      const heartIcon = card.querySelector('[data-role="heartIcon"]');
      
      // ফেভারিট স্ট্যাটাস অনুযায়ী হার্ট আইকনের রং সেট করা
      if (svc.isFavorite) {
        heartIcon.classList.remove('text-gray-400', 'hover:text-red-500');
        heartIcon.classList.add('text-red-500');
      }

      // UPDATED: ফেভারিট টগল লজিক
      card.querySelector('[data-role="heartBtn"]').addEventListener('click', (e) => {
        const index = state.services.findIndex(s => s.id === svc.id);
        if (index > -1) {
          state.services[index].isFavorite = !state.services[index].isFavorite;
          svc.isFavorite = state.services[index].isFavorite; // svc অবজেক্ট আপডেট করা

          if (svc.isFavorite) {
            state.hearts += 1;
            state.favoriteIds[svc.id] = true;
            // আইকনের রং পরিবর্তন
            e.currentTarget.querySelector('[data-role="heartIcon"]').classList.remove('text-gray-400');
            e.currentTarget.querySelector('[data-role="heartIcon"]').classList.add('text-red-500');
          } else {
            state.hearts = Math.max(0, state.hearts - 1); // হার্ট কমে গেলে 0 এর নিচে যেন না যায়
            delete state.favoriteIds[svc.id];
            // আইকনের রং পরিবর্তন
            e.currentTarget.querySelector('[data-role="heartIcon"]').classList.add('text-gray-400');
            e.currentTarget.querySelector('[data-role="heartIcon"]').classList.remove('text-red-500');
          }
          updateCounters();
          saveState(); // ফেভারিট স্ট্যাটাস সেভ করা
        }
      });

      card.querySelector('[data-role="copyBtn"]').addEventListener('click', () => {
        navigator.clipboard.writeText(svc.number)
          .then(() => {
            state.copies += 1;
            updateCounters();
            saveState(); // কপি কাউন্ট সেভ করা
            // Optional: Show a success toast/alert
            alert(`Number ${svc.number} copied!`);
          })
          .catch(() => alert('Copy failed. Please copy manually: ' + svc.number));
      });

      // UPDATED: সরাসরি ফোন কল লজিক (Coins/Alerts বাদ দেওয়া হয়েছে)
      card.querySelector('[data-role="callBtn"]').addEventListener('click', () => {
        // সরাসরি কল করার জন্য tel: প্রোটোকল ব্যবহার করা
        window.location.href = 'tel:' + svc.number; 
        
        // হিস্টোরি আপডেট করা
        const when = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit', second: '2-digit' });
        state.history.unshift({ title: svc.title, number: svc.number, time: when });
        
        // হিস্টোরি যাতে ৫টি পর্যন্ত দেখানো হয় (ঐচ্ছিক)
        if (state.history.length > 5) {
            state.history.pop();
        }

        renderHistory();
        saveState(); // হিস্টোরি সেভ করা
      });

      el.cardGrid.appendChild(card);
    });
  }

  function renderHistory() {
    el.historyList.innerHTML = '';
    state.history.forEach(h => {
      const li = document.createElement('li');
      li.className = 'flex items-center justify-between gap-3 bg-white rounded-xl border p-3 shadow-sm hover:shadow-md transition-shadow';
      li.innerHTML = `
        <div>
          <div class="font-semibold text-lg text-black leading-tight">${h.title}</div>
          <div class="text-sm text-black">${h.number}</div>
        </div>
        <div class="text-sm text-gray-500">${h.time}</div>
      `;
      el.historyList.appendChild(li);
    });
  }

  function bindGlobalUI() {
    el.clearHistory.addEventListener('click', () => {
      state.history = [];
      renderHistory();
      saveState(); // হিস্টোরি ক্লিয়ার করার পরে সেভ করা
    });
  }

  function updateCounters() {
    el.heartCount.textContent = state.hearts;
    // el.coinCount.textContent = state.coins; // কয়েন কাউন্ট বাদ দেওয়া হয়েছে
    el.copyCount.textContent = state.copies;
  }

  // UPDATED: রাজশাহী হেল্পলাইন নম্বর যুক্ত করা হয়েছে এবং সব সার্ভিসে একটি 'id' যোগ করা হয়েছে
  function getServices() {
    return [
      { id: 1, title: 'National Emergency Number', subtitle: 'National Emergency', number: '999', category: 'All', icon: './assets/emergency.png' },
      { id: 2, title: 'Police Helpline Number', subtitle: 'Police', number: '999', category: 'Police', icon: './assets/police.png' },
      { id: 3, title: 'Fire Service Number (National)', subtitle: 'Fire Service', number: '999', category: 'Fire', icon: './assets/fire-service.png' },
      { id: 4, title: 'Ambulance Service (General)', subtitle: 'Ambulance', number: '199', category: 'Health', icon: './assets/ambulance.png' }, // 199 is sometimes used as a general health helpline
      { id: 5, title: 'Women & Child Helpline', subtitle: 'Women & Child Helpline', number: '109', category: 'Help', icon: './assets/emergency.png' },
      { id: 6, title: 'Anti-Corruption Helpline', subtitle: 'Anti-Corruption', number: '106', category: 'Govt.', icon: './assets/emergency.png' },
      { id: 7, title: 'Electricity Helpline (BPDB)', subtitle: 'Electricity Outage', number: '16216', category: 'Electricity', icon: './assets/emergency.png' },
      { id: 8, title: 'Brac Helpline', subtitle: 'Brac', number: '16445', category: 'NGO', icon: './assets/brac.png' },
      { id: 9, title: 'Bangladesh Railway Helpline', subtitle: 'Bangladesh Railway', number: '163', category: 'Travel', icon: './assets/Bangladesh-Railway.png' },
      // --- রাজশাহী অঞ্চলের জন্য অতিরিক্ত নম্বর ---
      { id: 10, title: 'Rajshahi Fire Service', subtitle: 'Divisional Control Room', number: '01730-336655', category: 'Rajshahi', icon: './assets/fire-service.png' },
      { id: 11, title: 'Rajshahi Medical College', subtitle: 'Emergency Contact', number: '0721-772150', category: 'Rajshahi Health', icon: './assets/ambulance.png' },
      { id: 12, title: 'Rajshahi City Corp. Hotline', subtitle: 'General Services', number: '16105', category: 'Rajshahi Govt.', icon: './assets/emergency.png' },
      { id: 13, title: 'Rajshahi Palli Bidyut (RBS)', subtitle: 'Headquarter Hotline', number: '01769401764', category: 'Rajshahi Electricity', icon: './assets/emergency.png' },
    ];
  }

  document.addEventListener('DOMContentLoaded', init);
})();
</script>

</body>
</html>